@using PostexS.Models.ViewModels;
@model List<Shipment>
@{
    ViewData["Title"] = "طلبات Line Express";
}

<div class="panel panel-primary">
    <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-fw fa-truck"></i> طلبات Line Express</h3>
    </div>
    <div class="panel-body">
        <form asp-action="LineExpress" method="get" class="form-inline">
            <div class="form-group">
                <label for="fromDate">من تاريخ:</label>
                <input type="date" id="fromDate" name="fromDate" class="form-control"
                       value="@ViewBag.FromDate" max="@DateTime.Now.AddDays(-1).ToString("yyyy-MM-dd")" />
            </div>
            <div class="form-group">
                <label for="toDate">إلى تاريخ:</label>
                <input type="date" id="toDate" name="toDate" class="form-control"
                       value="@ViewBag.ToDate" min="@DateTime.Now.AddDays(-2).ToString("yyyy-MM-dd")"
                       max="@DateTime.Now.ToString("yyyy-MM-dd")" />
            </div>
            <div class="form-group">
                <label for="pageSize">عدد العناصر:</label>
                <select name="pageSize" class="form-control">
                    <option value="10" selected="@(ViewBag.PageSize == 10)">10</option>
                    <option value="25" selected="@(ViewBag.PageSize == 25)">25</option>
                    <option value="50" selected="@(ViewBag.PageSize == 50)">50</option>
                    <option value="100" selected="@(ViewBag.PageSize == 100)">100</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">بحث</button>
        </form>

        <div class="table-responsive" style="margin-top: 20px;">
            <table class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <th>كود الشحنة</th>
                        <th>تاريخ الشحنة</th>
                        <th>المرسل إليه</th>
                        <th>الهاتف</th>
                        <th>العنوان</th>
                        <th>المبلغ</th>
                        <th>حالة الشحنة</th>
                        <th>تاريخ التسليم</th>
                        <th>ملاحظات</th>
                        <th>الفرع الحالي</th>
                        <th>تكلفة الشحن</th>
                        <th>المندوب</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var shipment in Model)
                    {
                        <tr>
                            <td>@shipment.AWB</td>
                            <td>@shipment.TransDate.ToString("yyyy-MM-dd")</td>
                            <td>@shipment.ToConsigneeName</td>
                            <td>@shipment.ToPhone</td>
                            <td>@shipment.ToAddress</td>
                            <td>@shipment.COD.ToString("N0")</td>
                            <td>@shipment.StatusNameA</td>
                            <td>@(shipment.DeliveryDate?.ToString("yyyy-MM-dd") ?? "لم يتم التسليم")</td>
                            <td>@shipment.SpecialInstuctions</td>
                            <td>@shipment.CurrentBranch</td>
                            <td>@shipment.ShipmentFees.ToString("N0")</td>
                            <td>@shipment.RunnerName - @shipment.RunnerMobile</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Pagination will be added here -->
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const fromDate = document.getElementById('fromDate');
            const toDate = document.getElementById('toDate');

            // Prevent selecting same day in both fields
            fromDate.addEventListener('change', function() {
                toDate.min = this.value;
                if (new Date(toDate.value) < new Date(this.value)) {
                    toDate.value = this.value;
                }
            });

            toDate.addEventListener('change', function() {
                fromDate.max = this.value;
                if (new Date(fromDate.value) > new Date(this.value)) {
                    fromDate.value = this.value;
                }
            });
        });
    </script>
}