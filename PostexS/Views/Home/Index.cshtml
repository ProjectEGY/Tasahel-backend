@model PostexS.Models.ViewModels.CurrentStatisticsVM
@{
    @if (User.IsInRole("Admin"))
    {
        ViewData["Title"] = "الحسابات";
    }
    else { ViewData["Title"] = "الرئيسية"; }
}

<div class="text-center">
    <h1 class="display-4">مرحباً بك</h1>
    <p>أهلا بك فى تطبيق Tasahel Express</p>
</div>

@if (User.IsInRole("Client"))
{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Tajawal', sans-serif;
        }

        .panel {
            margin-top: 30px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            border-radius: 12px;
            background-color: #fff;
        }

        .panel-heading {
            background: linear-gradient(90deg, #007bff, #00c4b4);
            color: white;
            padding: 20px;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            font-size: 1.6em;
            text-align: center;
        }

        .panel-title {
            margin: 0;
            font-weight: bold;
        }

        .stat-value {
            font-size: 2.8em;
            font-weight: 700;
            color: #007bff;
        }

        .percentage {
            font-size: 1.3em;
            color: #28a745;
            font-weight: 500;
        }

        .panel-body {
            padding: 40px;
        }

        .stat-card {
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-bottom: 20px;
            background-color: #fff;
        }

            .stat-card:hover {
                transform: translateY(-8px);
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
                background-color: #e9f7ef;
            }

            .stat-card .card-body {
                padding: 25px;
                text-align: center;
            }

        .mt-4 {
            margin-top: 2rem !important;
        }

        .all-orders-card {
            background-color: #f0f4f8;
            border: 2px solid #007bff;
        }

        .deleted-card {
            background-color: #f8d7da;
            border: 2px solid #dc3545;
        }

            .deleted-card .stat-value {
                color: #dc3545;
            }

            .deleted-card .percentage {
                color: #dc3545;
            }

        .assigned-card {
            background-color: #fff3cd;
            border: 2px solid #ffc107;
        }

            .assigned-card .stat-value {
                color: #ffc107;
            }

            .assigned-card .percentage {
                color: #ffc107;
            }

        .stat-card .card-body h5 {
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 1.2em;
            color: #333;
        }

        canvas {
            margin-top: 40px;
            background-color: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
    </style>

    <div class="container">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="fa fa-fw fa-chart-bar"></i> @ViewBag.Title</h3>
            </div>

            <div class="panel-body">
                <div class="row">
                    <!-- إجمالي جميع الطلبات -->
                    <div class="col-md-4">
                        <div class="card stat-card text-center all-orders-card">
                            <div class="card-body">
                                <div class="stat-value">@Model.AllOrdersCount</div>
                                <h5>إجمالي جميع الطلبات</h5>
                            </div>
                        </div>
                    </div>

                    <!-- الطلبات الحالية -->
                    <div class="col-md-4">
                        <div class="card stat-card text-center">
                            <div class="card-body">
                                <div class="stat-value">@Model.CurrentOrdersCount</div>
                                <h5>الطلبات الحالية</h5>
                            </div>
                        </div>
                    </div>

                    <!-- الطلبات المعلقة -->
                    <div class="col-md-4">
                        <div class="card stat-card text-center">
                            <div class="card-body">
                                <div class="stat-value">@Model.WaitingCount</div>
                                <h5>الطلبات المعلقة</h5>
                                <div class="percentage">(@Model.WaitingPercentage.ToString("0.00")%)</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <!-- الطلبات مع المناديب -->
                    <div class="col-md-4">
                        <div class="card stat-card text-center assigned-card">
                            <div class="card-body">
                                <div class="stat-value">@Model.AssignedCount</div>
                                <h5>الطلبات مع المناديب</h5>
                                <div class="percentage">(@Model.AssignedPercentage.ToString("0.00")%)</div>
                            </div>
                        </div>
                    </div>

                    <!-- الطلبات المستلمة -->
                    <div class="col-md-4">
                        <div class="card stat-card text-center">
                            <div class="card-body">
                                <div class="stat-value">@Model.DeliveredCount</div>
                                <h5>الطلبات المستلمة</h5>
                                <div class="percentage">(@Model.DeliveredPercentage.ToString("0.00")%)</div>
                            </div>
                        </div>
                    </div>

                    <!-- الطلبات المرفوضة -->
                    <div class="col-md-4">
                        <div class="card stat-card text-center">
                            <div class="card-body">
                                <div class="stat-value">@Model.RejectedCount</div>
                                <h5>الطلبات المرفوضة</h5>
                                <div class="percentage">(@Model.RejectedPercentage.ToString("0.00")%)</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <!-- الطلبات المستلمة جزئياً -->
                    <div class="col-md-4">
                        <div class="card stat-card text-center">
                            <div class="card-body">
                                <div class="stat-value">@Model.PartialDeliveredCount</div>
                                <h5>الطلبات المستلمة جزئياً</h5>
                                <div class="percentage">(@Model.PartialDeliveredPercentage.ToString("0.00")%)</div>
                            </div>
                        </div>
                    </div>

                    <!-- الطلبات المرتجعة -->
                    <div class="col-md-4">
                        <div class="card stat-card text-center">
                            <div class="card-body">
                                <div class="stat-value">@Model.ReturnedCount</div>
                                <h5>الطلبات المرتجعة</h5>
                                <div class="percentage">(@Model.ReturnedPercentage.ToString("0.00")%)</div>
                            </div>
                        </div>
                    </div>

                    <!-- الطلبات المرتجعة جزئياً -->
                    <div class="col-md-4">
                        <div class="card stat-card text-center">
                            <div class="card-body">
                                <div class="stat-value">@Model.PartialReturnedCount</div>
                                <h5>الطلبات المرتجعة جزئياً</h5>
                                <div class="percentage">(@Model.PartialReturnedPercentage.ToString("0.00")%)</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <!-- الطلبات المحذوفة -->
                    <div class="col-md-4">
                        <div class="card stat-card text-center deleted-card">
                            <div class="card-body">
                                <div class="stat-value">@Model.DeletedCount</div>
                                <h5>الطلبات المحذوفة</h5>
                                <div class="percentage">(@Model.DeletedPercentage.ToString("0.00")%)</div>
                            </div>
                        </div>
                    </div>

                    <!-- إجمالي المبلغ -->
                    <div class="col-md-4">
                        <div class="card stat-card text-center">
                            <div class="card-body">
                                <div class="stat-value">@Model.OrdersMoney.ToString("N0") ج</div>
                                <h5>إجمالي المبلغ</h5>
                            </div>
                        </div>
                    </div>

                    <!-- نسبة الراسل -->
                    <div class="col-md-4">
                        <div class="card stat-card text-center">
                            <div class="card-body">
                                <div class="stat-value">@Model.DriverMoney.ToString("N0") ج</div>
                                <h5>نسبة الراسل</h5>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <!-- نسبة النظام -->
                    <div class="col-md-4 offset-md-4">
                        <div class="card stat-card text-center">
                            <div class="card-body">
                                <div class="stat-value">@Model.SystemMoney.ToString("N0") ج</div>
                                <h5>نسبة النظام</h5>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- الرسم البياني -->
                <div class="row mt-4">
                    <div class="col-md-12">
                        <canvas id="ordersChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        var ctx = document.getElementById('ordersChart').getContext('2d');
        var ordersChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['جميع الطلبات', 'الطلبات الحالية', 'المعلقة', 'مع المناديب', 'المستلمة', 'المرفوضة', 'المستلمة جزئياً', 'المرتجعة', 'المرتجعة جزئياً', 'المحذوفة'],
                datasets: [{
                    label: 'إحصائيات الطلبات',
                    data: [
                        @Model.AllOrdersCount,
                        @Model.CurrentOrdersCount,
                        @Model.WaitingCount,
                        @Model.AssignedCount,
                        @Model.DeliveredCount,
                        @Model.RejectedCount,
                        @Model.PartialDeliveredCount,
                        @Model.ReturnedCount,
                        @Model.PartialReturnedCount,
                        @Model.DeletedCount
                    ],
                    backgroundColor: [
                        '#007bff',
                        '#6c757d',
                        '#ffc107',
                        '#ff851b',
                        '#28a745',
                        '#dc3545',
                        '#fd7e14',
                        '#6f42c1',
                        '#17a2b8',
                        '#e74c3c'
                    ],
                    borderColor: [
                        '#0056b3',
                        '#5a6268',
                        '#e0a800',
                        '#e07600',
                        '#218838',
                        '#c82333',
                        '#e06c00',
                        '#5a32a3',
                        '#138496',
                        '#c0392b'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'عدد الطلبات'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'حالة الطلب'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        backgroundColor: '#fff',
                        titleColor: '#333',
                        bodyColor: '#333',
                        borderColor: '#007bff',
                        borderWidth: 1
                    }
                }
            }
        });
    </script>
}
else if (User.IsInRole("Admin") || User.IsInRole("TrustAdmin"))
{
    <div class="panel panel-primary">
        <div class="panel-heading">
            <h3 class="panel-title"><i class="fa fa-fw fa-globe"></i> أختر المده</h3>
        </div>
        @using (Html.BeginForm("Index", "Home", FormMethod.Get))
        {
            <input name="id" id="id" hidden value="@ViewBag.UserId" />
            <input name="type" id="type" hidden value="@ViewBag.typ" />
            <div class="row">
                <div class="col-lg-2 text-center"></div>
                <div class="col-lg-3">
                    <input name="FilterTime" id="FilterTime" type="date" class="form-control" />
                </div>
                <div class="col-lg-2 text-center">
                    <label style="vertical-align:central" class="text-center">إلــى</label>
                </div>
                <div class="col-lg-3">
                    <input name="FilterTimeTo" id="FilterTimeTo" type="date" class="form-control" />
                </div>
                <div class="col-lg-2 text-center"></div>
                <div class="col-lg-5 text-center"></div>
                <div class="col-lg-2">
                    <button type="submit" class="btn btn-primary form-control">بحــث</button>
                </div>
            </div>
        }
    </div>

    @if (User.IsInRole("Admin"))
    {
        <div class="panel panel-success">
            <div id="collapseOne" class="panel-collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="panel-body">
                    <div class="row" style="color:white">
                        <div class="col-lg-12 mt-15 mb-15">
                            <div class="separator">&nbsp;&nbsp;&nbsp;&nbsp;ربح Postex&nbsp;&nbsp;&nbsp;&nbsp;</div>
                        </div>
                        <div class="col-lg-3 col-md-12 text-center mt-15 mb-15"></div>
                        <div class="col-lg-6 col-md-12 text-center mt-15 mb-15" style="background-color:forestgreen; border-radius:30px; height:60px; box-shadow:forestgreen 1px 1px 1px;">
                            <h4>نسبة الربح هذه الفتره</h4>
                            <h5>@ViewBag.wallet جنية</h5>
                        </div>
                        <div class="col-lg-3 col-md-12 text-center mt-15 mb-15"></div>
                    </div>
                </div>
            </div>
        </div>
    }
}